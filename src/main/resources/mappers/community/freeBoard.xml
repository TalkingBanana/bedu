<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.care.bedu.community.freeBoard.dao.FreeDAO">
	
	<select id="viewlist" resultType="com.care.bedu.community.freeBoard.vo.FreeVO">
		SELECT
		 * FROM (SELECT
		  ROWNUM rnum,
		  COMM_NUM as comm_num,
		  TITLE,
		  CONTENT,
		  COMM_DATE as comm_date,
		  COMM_CNT as comm_cnt,
		  COMM_LIKE_YN as comm_like_yn,
		  REG_ID,
		  u.USER_NAME,
		  u.USER_ID,
		  u.USER_NUM 
		FROM T_BEDU_COMM c LEFT JOIN T_BEDU_USER u ON c.USER_NAME = u.USER_NAME 
		ORDER BY COMM_NUM DESC) 
		WHERE rnum >= #{page} AND #{limit} >= rnum
	</select>
	
	<select id="viewsearch" resultType="com.care.bedu.community.freeBoard.vo.FreeVO">
		SELECT 
		 COMM_NUM,
		 TITLE, 
		 CONTENT, 
		 USER_NAME, 
		 COMM_DATE, 
		 COMM_CNT, 
		 REG_ID 
		FROM T_BEDU_COMM
		<if test="keyword != null">
			WHERE CONTENT LIKE '%'||#{keyword}||'%' OR TITLE LIKE '%'||#{keyword}||'%'
		 </if>
		 ORDER BY COMM_NUM DESC
	</select>
	
	<insert id="viewWrite">
		INSERT INTO T_BEDU_COMM(
		  COMM_NUM,
		  USER_NAME, 
          TITLE, 
          CONTENT, 
          COMM_CNT, 
          COMM_LIKE_YN, 
          COMM_DATE, 
          REG_DATE, 
          REG_ID
		)VALUES(
		  BEDU_COMM.NEXTVAL,
          #{user_name}, 
          #{title}, 
          #{content}, 
          #{comm_cnt}, 
          #{comm_like_yn}, 
          SYSDATE, 
          SYSDATE, 
          #{reg_id}
		)
	</insert>
	
	<select id="viewone" resultType="com.care.bedu.community.freeBoard.vo.FreeVO">
		SELECT 
		 COMM_NUM,
		 TITLE,
		 CONTENT,
		 COMM_DATE,
		 COMM_CNT,
		 COMM_LIKE_YN, 
		 REG_ID,
		 u.USER_NAME,
		 u.USER_NUM
		FROM T_BEDU_COMM c LEFT JOIN T_BEDU_USER u ON c.USER_NAME = u.USER_NAME
		WHERE COMM_NUM = #{num}
	</select>
	
	<delete id="viewdelete">
		DELETE
		 FROM T_BEDU_COMM 
		WHERE COMM_NUM = #{num}
	</delete>
	
	<update id="cntUp">
		UPDATE
		 T_BEDU_COMM SET COMM_CNT = COMM_CNT + 1
		WHERE COMM_NUM = #{num}
	</update>
	
	<update id="viewupdate">
		UPDATE
		 T_BEDU_COMM SET TITLE = #{title}, CONTENT = #{content}
		WHERE COMM_NUM = #{comm_num}
	</update>
	
	<select id="getTotal" resultType="int">
		SELECT COUNT(*) FROM T_BEDU_COMM
	</select>
	
	<select id="getuserId" resultType="com.care.bedu.community.freeBoard.vo.FreeVO">
		SELECT
		 USER_ID
		FROM T_BEDU_USER
		WHERE USER_NAME = #{userName}
	</select>
	
	<update id="freelikeUp">
		UPDATE
		 T_BEDU_COMM SET COMM_LIKE_YN = COMM_LIKE_YN + 1
		WHERE COMM_NUM = #{num}
	</update>
	
	<update id="freelikeDown">
		UPDATE
		 T_BEDU_COMM SET COMM_LIKE_YN = COMM_LIKE_YN - 1
		WHERE COMM_NUM = #{num}
	</update>
	
</mapper>