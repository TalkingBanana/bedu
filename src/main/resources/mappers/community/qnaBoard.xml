<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.care.bedu.community.qna.dao.QnaDAO">
	
	<select id="viewlist" resultType="com.care.bedu.community.qna.vo.QnaVO">
		SELECT 
		 QS_BD_NUM AS qna_bd_num, 
		 TITLE, 
		 CONTENT, 
		 QS_CNT AS qna_cnt, 
		 QS_LIKE_YN AS qna_like_yn, 
		 USER_ID,
		 QS_DATE AS qna_date, 
		 REG_ID 
		FROM T_BEDU_QS
		ORDER BY QS_BD_NUM DESC
		 LIMIT 5 OFFSET #{page}
	</select>
	
	<insert id="viewWrite">
		INSERT INTO T_BEDU_QS(
		  USER_ID,
		  TITLE, 
		  CONTENT,
		  QS_CNT,
		  QS_LIKE_YN,
		  QS_DATE,
		  REG_DATE,
		  REG_ID
		)VALUES(
		  #{user_id},
		  #{title},
		  #{content},
		  #{qna_cnt},
		  #{qna_like_yn},
		  SYSDATE(),
		  SYSDATE(),
		  #{reg_id}
	    )
	</insert>
	
	<select id="viewone" resultType="com.care.bedu.community.qna.vo.QnaVO">
		SELECT * FROM T_BEDU_QS
		WHERE QS_BD_NUM = #{num}
	</select>
	
	<update id="viewupdate">
		UPDATE T_BEDU_QS SET TITLE = #{title}, CONTENT = #{content}
		WHERE QS_BD_NUM = #{qna_bd_num}
	</update>
	
	<delete id="viewdelete">
		DELETE FROM T_BEDU_QS
		WHERE QS_BD_NUM = #{qnanum}
	</delete>
	
	<select id="viewsearch" resultType="com.care.bedu.community.qna.vo.QnaVO">
		SELECT QS_BD_NUM, TITLE, CONTENT, USER_ID, QS_DATE, QS_CNT, QS_LIKE_YN, REG_ID FROM T_BEDU_QS
		<if test="keyword != null">
			WHERE TITLE LIKE concat ('%', #{keyword},'%') OR CONTENT LIKE CONCAT ('%', #{keyword},'%')
			 ORDER BY QS_BD_NUM DESC
		 </if>
	</select>
	
	<select id="getTotal" resultType="int">
		SELECT COUNT(*) FROM T_BEDU_QS
	</select>
	
	<update id="qnaCntUp">
		UPDATE T_BEDU_QS SET QS_CNT = QS_CNT + 1
		WHERE QS_BD_NUM = #{num}
	</update>
	
	<update id="likeUp">
		UPDATE T_BEDU_QS SET QS_LIKE_YN = QS_LIKE_YN + 1
		WHERE QS_BD_NUM = #{num}
	</update>
	
</mapper>